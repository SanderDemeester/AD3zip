17454July1973
Categories:Protocols,FTP
References:RFC520
CommentsonFileAccessProtocol
Afileaccessprotocol(FAP)ofthesortproposedbyJohnDayinRFC
520isagoodidea.Thefollowingcommentssuggestimprovements
(mostlyadditions)totheprotocoldescribedinRFC520.
1.(Philosophicalcomment)TheintentofbothFTPandFAPisto
makeitpossibleforausertoremotelyaccessfiles.Ineffect,
FTPprovidesmeansforausertohave(partsof)fileactivityof
thesorttypicallyinitiatedatthecommandlanguagelevel
"slaved"acrossthenetworktothesitewherethefileresides.
InasimilarwaytheintentofFAPistoprovideamechanism
whichallowsactivityofthesorttypicallyinitiatedbyprograms
attheoperatingsystemormonitorleveltobe"slaved"across
thenetworktothesitewherethefileresides.TheOPEN,CLOS,
SETP,etc.commandsofFAPcanbeviewedasattemptstodefine
"generic"filesystemmonitorcalls.Thesuggestionsmadebelow
arefurtherattemptstomakefeaturestypicallyavailableto
localusersalsoavailabletoremoteusersviaFAP.
2.TheOPENcommandshouldallowforathirdOPENmodecalledAfor
append.Intermsofitsactionwithrespecttoafileandfile
pointer,thecommand
OPENAFOO
wouldbeequivalenttothesequence:
OPENWFOO
SETPE
Thedifferencewouldbewithrespecttoaccesscontrol.Many
systemsallowausertocontrolseparatelywriteandappend
accesstoafile(e.g.,onTENEXauserusuallysetsthe
protectiononhisMESSAGE.TXTfilesuchthatanyonecanappendto
itbutonlyhecanwriteit).ForsuchsystemstheappendOPEN
wouldsucceedinmanycasesinwhichthewriteOPENwouldfail.
TheprinciplehereisthatFAP(toaslargeasdegreeasis
practical)shouldallowremoteuserstoaccessfilesinthesame
wayaslocalusersmay.
3.Theprotocolasproposedallowsforthecreationofnon-
sequentialfilesbutprovidesnoconvenientwayforremotely
accessingthemaftertheyarecreated.Forexampleifsenttoa
TENEXserver,thesequence:
OPENWFOO//bytesizeassumed=36
SETPB
WRITE512
SETP1024
WRITE512
CLOS
wouldcreateafileFOOwithtwopages(onTENEXapage=51236
bitwords).Thetwopageswouldbepage#0andpage#2;because
page#1doesnotexistthefileissaidtohavea"hole"init.
AccesstoFOOviaFAPwouldbedifficultunlesstheremoteuser
knewits(page)structurepriortoaccess.Tosupportremote
accesstofilessuchasFOO,FAPshouldhavemeansforauserto
determineafile'sstructure.Consideravalue-returningcommand
thatreturnsthevaluethefilepointershouldbesettoinorder
topointtothefirstbyteofthenextusedpage(blockor
record)beyondthecurrentpositionofthefilepointer.With
suchacommand,callitFNUB(FindNextUsedBlock),the
followingsequencecouldbeusedtoretrieveaholeyfilesuchas
FOO:
OPENRFILE
SETPB
a:FNUB//letx=thevaluereturned
ifx=null
thenCLOS
else(SETPx
READ512//pagesize=512
gotoa)
Thispresumesthattheremoteuserknowstheblock(page)sizeso
thathecanproperlyaccessthefile.Onecanimaginefiles
havingblocksofvariablesize;perhapsFNUBshouldreturntwo
values:thefilepointerpositionofthenextblockandthesize
ofthatblockinbytes.
4.FAPshouldprovidemeansforaremoteusertoacquirecertain
statusand"descriptor"informationaboutagivenfile.The
followingisa(non-exhaustive)listofinformationwhichwould
beusefultoauserremotelyaccessingTENEXfiles:
-user'saccesstofile;canheread,write,executeorappend
thefile?
-sizeinformation;bytesizeusedinlastwriteaccess(OPEN
W)ofthefile;filesizeinbytes(ofthatsize).
-fileaccessdates;dateofcreate,lastread,lastwrite.
-onTENEXausercanspecifydifferentaccesscontrolfor
differentpageswithinthesamefile;aremoteusershouldbe
abletoacquiresuchaccesscontrolinformationaboutfiles
(andbeabletospecifysuchaccesscontrolwhenhecreates
them).
5.Therearemanyapplicationsinwhicharemoteuserwouldliketo
accessseveralfilessimultaneouslyinmuchthesamewayasa
localusercan.FAPasproposedcannotsupportsuchmultiple
fileaccess(ofcourse,theuseralwayshastheoptionofgoing
throughanICPtoestablishanotherconnectionwiththeserver).
FAPcanbeextendedinasimplewaytosupportmultiplefile
accessbyincludingthenotionofa"filehandle"whichisused
tospecifywhichfileagivenFAPcommandrefersto.Whenthe
userdoes:
OPENRFOO
theserver'sresponsewouldincludeahandleforFOOwhichthe
userwoulduseinsubsequentreferencestoFOO.Thehandle
returnedwouldbeastringoftheserver'schoice;itmightbe
thefile'sname(FOO),asmallinteger,etc.Useofa(server
chosen)filehandleratherthanthecompletefilenameenables
theservertorespondtoFAPcommandswithoutincurringthe
overheadofre-parsingthefilenameforeachcommand.To
illustrate,considerthefollowingsequencewhichopensafile
forreadingandoneforwriting,reads3bytesfromthefirst
fileasdata,computesusingthedataandwritesa2byteresult
tothesecondfile:
OPENRFOO//serverreturnsFHashandle
OPENWMOO//serverreturnsMHashandle
READ3FH//userreadsdata
//Userdoessomecomputationonthe3bytes
WRIT2MH//userwritestheresult
CLOSMH
CLOSFH
Reasonabledefaultscouldbeprovidedwithhandles:e.g.,aFAP
commandwithoutahandlereferstothesamefileastheprevious
command;etc.(Theassociationofahandlewithafileis
probablybetterachievedviaaseparateFAPcommandratherthan
asasideeffectoftheOPENcommand;e.g.,
HNDLFOO)
6.Itisimportanttotakelocaltransformationsintoaccount(page
3ofRFC520).However,itisequallyimportanttoallowa
remoteusertosuppresslocaltransformations,ifhewishes,so
thathecanaccessthefileasitisstored.Thiswouldenablea
programthatmanipulatesafiletoworkequallywellwhetherthe
fileislocal(andaccessed"directly"viasystemcalls)or
remote(andaccessed"indirectly"viasystemcallsthatare
"trapped"andtransformedinto
